//var coffee = require('coffee-script');
var path = require('path');
var createAriaTemplatePreprocessor = function(args, config, logger, helper) {
  

  var transformPath = function(filepath) {
    return filepath.replace(/\.tpl$/, '.js');
  };

  return function(content, file, done) {
    console.log("[INFO] Starting ATPreprocessor");
    console.log("[INFO] Processing file "+ file);

    var path = require("path");
    //get Module directory
    var dirname = path.join(__dirname, '../..');

     var grunt = require(dirname + "/node_modules/grunt");
     var exec =require('child_process').exec
     var nmBuildCommand = 'grunt build';
     var nmDirname = path.join(__dirname, '../..');
     
      exec(nmBuildCommand, {
        cwd: nmDirname
      }, function() {  console.log("[INFO] Finishing ATPreprocessor"); });
     setTimeout( function(){done(content);},5000);
  };
 };

createAriaTemplatePreprocessor.$inject = ['args', 'config.ariaTemplatePreprocessor', 'logger', 'helper'];

// PUBLISH DI MODULE
module.exports = {
  'preprocessor:ariatemplate': ['factory', createAriaTemplatePreprocessor]
};
